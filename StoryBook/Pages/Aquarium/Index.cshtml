@page "{index:int?}"
@model StoryBook.Pages.Aquarium.IndexModel
@{
    ViewData["Title"] = "æ°´æ—é¤¨å‹•ç‰©ä»‹ç´¹";
    var prevButtonClass = Model.HasPrevious ? "nav-button nav-button-prev" : "nav-button nav-button-prev disabled";
    var nextButtonClass = Model.HasNext ? "nav-button nav-button-next" : "nav-button nav-button-next disabled";
}

<link rel="stylesheet" href="~/css/aquarium.css" asp-append-version="true" />

<div class="aquarium-page">
    @if (Model.IsCoverPage)
    {
        <!-- å°é¢é  -->
        <div class="aquarium-cover">
            <div class="cover-decoration">
                <span class="bubble bubble-1">ğŸ«§</span>
                <span class="bubble bubble-2">ğŸ«§</span>
                <span class="bubble bubble-3">ğŸ«§</span>
            </div>
            
            <div class="cover-content">
                <div class="cover-emoji">ğŸ </div>
                <h1 class="cover-title" data-lang-zh="æ°´æ—é¤¨å‹•ç‰©ä»‹ç´¹" data-lang-en="Aquarium Animals">
                    æ°´æ—é¤¨å‹•ç‰©ä»‹ç´¹
                </h1>
                <p class="cover-subtitle">
                    <span data-lang-zh="æ­¡è¿ä¾†åˆ°ç¥å¥‡çš„æµ·åº•ä¸–ç•Œï¼" data-lang-en="Welcome to the magical underwater world!">
                        æ­¡è¿ä¾†åˆ°ç¥å¥‡çš„æµ·åº•ä¸–ç•Œï¼
                    </span>
                    <br>
                    <span data-lang-zh="ä¸€èµ·ä¾†èªè­˜é€™äº›å¯æ„›çš„æµ·æ´‹æœ‹å‹å§ï¼" data-lang-en="Let's meet these adorable ocean friends!">
                        ä¸€èµ·ä¾†èªè­˜é€™äº›å¯æ„›çš„æµ·æ´‹æœ‹å‹å§ï¼
                    </span>
                </p>
                
                @if (Model.CanEnterFromCover)
                {
                    <a asp-page="/Aquarium/Index" asp-route-index="0" class="btn-enter-aquarium">
                        <span class="btn-icon">ğŸ‹</span>
                        <span data-lang-zh="é–‹å§‹æ¢ç´¢" data-lang-en="Start Exploring">é–‹å§‹æ¢ç´¢</span>
                    </a>
                }
                
                <div class="cover-stats">
                    <span data-lang-zh="å…± @Model.TotalCount ç¨®æµ·æ´‹å‹•ç‰©ç­‰ä½ ä¾†èªè­˜" data-lang-en="@Model.TotalCount ocean animals waiting for you">
                        å…± @Model.TotalCount ç¨®æµ·æ´‹å‹•ç‰©ç­‰ä½ ä¾†èªè­˜
                    </span>
                </div>
            </div>
            
            <div class="cover-animals">
                <span class="animal-icon">ğŸ™</span>
                <span class="animal-icon">ğŸ¦ˆ</span>
                <span class="animal-icon">ğŸ¢</span>
                <span class="animal-icon">ğŸ¦‘</span>
                <span class="animal-icon">ğŸ¡</span>
            </div>
        </div>
    }
    else
    {
        <!-- å‹•ç‰©å…§å®¹é  -->
        <h1 class="aquarium-page-title">
            <span>ğŸ </span>
            <span data-lang-zh="æ°´æ—é¤¨å‹•ç‰©ä»‹ç´¹" data-lang-en="Aquarium Animals">æ°´æ—é¤¨å‹•ç‰©ä»‹ç´¹</span>
            <span>ğŸŸ</span>
        </h1>

        <!-- T033: æœå°‹æ¡† UI -->
        <div class="aquarium-search-container">
            <div class="search-box">
                <span class="search-icon">ğŸ”</span>
                <input type="text" 
                       id="animal-search-input" 
                       class="search-input" 
                       placeholder="æœå°‹å‹•ç‰©åç¨±ã€ç”Ÿæ´»ç’°å¢ƒã€é£Ÿæ€§..."
                       data-placeholder-zh="æœå°‹å‹•ç‰©åç¨±ã€ç”Ÿæ´»ç’°å¢ƒã€é£Ÿæ€§..."
                       data-placeholder-en="Search name, habitat, diet..."
                       autocomplete="off"
                       aria-label="æœå°‹æ°´æ—é¤¨å‹•ç‰©">
                <button type="button" id="clear-search-btn" class="clear-search-btn" style="display: none;" aria-label="æ¸…é™¤æœå°‹">
                    âœ•
                </button>
            </div>
            <!-- T036: æœå°‹çµæœæç¤º -->
            <div id="search-results-info" class="search-results-info" style="display: none;">
                <span class="results-count"></span>
                <span class="results-text"></span>
            </div>
            <!-- T036: ç„¡çµæœæç¤º -->
            <div id="no-results-message" class="no-results-message" style="display: none;">
                <div class="no-results-icon">ğŸ™</div>
                <p class="no-results-text" data-lang-zh="æ‰¾ä¸åˆ°ç›¸é—œå‹•ç‰©ï¼Œè©¦è©¦å…¶ä»–é—œéµå­—å§ï¼" data-lang-en="No animals found. Try other keywords!">
                    æ‰¾ä¸åˆ°ç›¸é—œå‹•ç‰©ï¼Œè©¦è©¦å…¶ä»–é—œéµå­—å§ï¼
                </p>
            </div>
        </div>

        @if (Model.CurrentAnimal is not null)
        {
            <!-- ä½¿ç”¨ Partial View é¡¯ç¤ºå‹•ç‰©å¡ç‰‡ -->
            <partial name="_AnimalCard" model="Model.CurrentAnimal" />
        }
        else
        {
            <div class="alert alert-warning text-center" role="alert">
                <h4>ğŸ  ç›®å‰æ²’æœ‰å‹•ç‰©è³‡æ–™</h4>
                <p data-lang-zh="è«‹ç¨å¾Œå†è©¦ï¼Œæˆ–æª¢æŸ¥è³‡æ–™æª”æ¡ˆæ˜¯å¦æ­£ç¢ºè¨­å®šã€‚" data-lang-en="Please try again later or check if the data file is set up correctly.">
                    è«‹ç¨å¾Œå†è©¦ï¼Œæˆ–æª¢æŸ¥è³‡æ–™æª”æ¡ˆæ˜¯å¦æ­£ç¢ºè¨­å®šã€‚
                </p>
            </div>
        }

        <!-- æ›é å’Œå°èˆªæŒ‰éˆ• -->
        <div class="aquarium-navigation">
            <!-- ä¸Šä¸€é æŒ‰éˆ• -->
            @if (Model.HasPrevious)
            {
                <a asp-page="/Aquarium/Index" asp-route-index="@(Model.CurrentIndex - 1)" class="@prevButtonClass">
                    <span class="nav-button-icon">â¬…ï¸</span>
                    <span data-lang-zh="ä¸Šä¸€é " data-lang-en="Previous">ä¸Šä¸€é </span>
                </a>
            }
            else
            {
                <span class="@prevButtonClass" aria-disabled="true">
                    <span class="nav-button-icon">â¬…ï¸</span>
                    <span data-lang-zh="ä¸Šä¸€é " data-lang-en="Previous">ä¸Šä¸€é </span>
                </span>
            }

            <!-- å›é¦–é æŒ‰éˆ• -->
            <a asp-page="/Index" class="nav-button nav-button-home">
                <span class="nav-button-icon">ğŸ </span>
                <span data-lang-zh="å›é¦–é " data-lang-en="Home">å›é¦–é </span>
            </a>

            <!-- ä¸‹ä¸€é æŒ‰éˆ• -->
            @if (Model.HasNext)
            {
                <a asp-page="/Aquarium/Index" asp-route-index="@(Model.CurrentIndex + 1)" class="@nextButtonClass">
                    <span data-lang-zh="ä¸‹ä¸€é " data-lang-en="Next">ä¸‹ä¸€é </span>
                    <span class="nav-button-icon">â¡ï¸</span>
                </a>
            }
            else
            {
                <span class="@nextButtonClass" aria-disabled="true">
                    <span data-lang-zh="ä¸‹ä¸€é " data-lang-en="Next">ä¸‹ä¸€é </span>
                    <span class="nav-button-icon">â¡ï¸</span>
                </span>
            }
        </div>

        <!-- é é¢è³‡è¨Š -->
        @if (Model.TotalCount > 0)
        {
            <div class="text-center mt-3">
                <small class="text-muted aquarium-page-info">
                    <span data-lang-zh="ç¬¬" data-lang-en="">ç¬¬</span>
                    <span class="page-number">@(Model.CurrentIndex + 1)</span>
                    <span data-lang-zh="é ï¼Œå…±" data-lang-en="of"> é ï¼Œå…± </span>
                    <span class="total-pages">@Model.TotalCount</span>
                    <span data-lang-zh="é " data-lang-en="pages"> é </span>
                </small>
            </div>
        }

        <!-- T034: æœå°‹çµæœå¿«é€Ÿè·³è½‰åˆ—è¡¨ï¼ˆç”± JavaScript å‹•æ…‹ç”¢ç”Ÿï¼‰ -->
        <div id="search-quick-nav" class="search-quick-nav" style="display: none;">
            <div class="quick-nav-title">
                <span class="quick-nav-icon">ğŸ”</span>
                <span data-lang-zh="æœå°‹çµæœ" data-lang-en="Search Results">æœå°‹çµæœ</span>
            </div>
            <div id="search-quick-nav-list" class="quick-nav-list">
                <!-- å‹•æ…‹ç”¢ç”Ÿçš„æœå°‹çµæœåˆ—è¡¨ -->
            </div>
        </div>
    }
</div>

<!-- T034: å‹•ç‰©è³‡æ–™ï¼ˆä¾› JavaScript æœå°‹ä½¿ç”¨ï¼‰ -->
<script id="aquarium-animals-data" type="application/json">
@Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.AllAnimals.Select(a => new {
    id = a.Id,
    index = Model.AllAnimals.ToList().IndexOf(a),
    nameZh = a.Name.Zh,
    nameEn = a.Name.En,
    habitatZh = a.Habitat.Zh,
    habitatEn = a.Habitat.En,
    dietZh = a.Diet.Zh,
    dietEn = a.Diet.En,
    locationZh = a.Location.Zh,
    locationEn = a.Location.En,
    habitatZone = a.HabitatZone.ToString().ToLowerInvariant(),
    habitatZoneZh = a.HabitatZone.GetDisplayName().Zh,
    habitatZoneEn = a.HabitatZone.GetDisplayName().En,
    mainImage = a.Images.Main
}), new System.Text.Json.JsonSerializerOptions { WriteIndented = false }))
</script>

@section Scripts {
    <script src="~/js/aquarium.js" asp-append-version="true"></script>
}
